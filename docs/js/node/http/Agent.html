<!DOCTYPE html>
<html lang="en"><!-- use theme color or fallback -->
<!--use textcolor from settings, otherwise create a contrasting color to theme color-->
<head><meta charset="utf-8"/><link href="../../../bootstrap/css/bootstrap.min.css" rel="stylesheet"/><link href="../../../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet"/><link href="../../../bootstrap/css/bootstrap-select.min.css" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,700italic,400italic" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600,600italic,400" rel="stylesheet" type="text/css"/><link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet" type="text/css"/><script src="../../../jquery-3.6.0.min.js"></script><script src="../../../bootstrap/js/bootstrap.min.js"></script><script src="../../../bootstrap/js/bootstrap-select.min.js"></script><link href="../../../styles.css" rel="stylesheet"/><link href="../../../extra-styles.css" rel="stylesheet"/><link href="../../../haxe-nav.css" rel="stylesheet"/><link href="../../../dark-mode.css" rel="stylesheet"/><script>var dox = {rootPath: "../../../",platforms: ["acerola"]};</script><script src="../../../nav.js"></script><script src="../../../index.js"></script><link rel="icon" href="../../../favicon.ico" type="image/x-icon"/><title>js.node.http.Agent - Acerola Docs</title><meta name="description" content="An &lt;code&gt;&lt;a href=&quot;../../../js/node/http/Agent.html#Agent&quot;&gt;Agent&lt;/a&gt;&lt;/code&gt; is responsible for managing connection persistence and reuse for HTTP clients.
It maintains a queue of pending requests for a given host and port, reusing a single socket connection for each until the queue is empty,
at which time the socket is either destroyed or put into a pool where it is kept to be used again for requests to the same host and port.
Whether it is destroyed or pooled depends on the &lt;code&gt;keepAlive&lt;/code&gt; option."/></head><body><script>/* Here to prevent flash of unstyled content */let systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if ((!localStorage.theme && systemDarkMode) || localStorage.theme == "dark") {document.body.style.backgroundColor = "#111";document.body.style.opacity = "0";document.addEventListener("DOMContentLoaded", function(event) {toggleTheme();document.body.style.backgroundColor = "";document.body.style.opacity = "";});}</script><style>
.navbar .brand {
	display: inline-block;
	float: none;
	text-shadow: 0 0 0 transparent;
}
</style><nav class="nav"><div class="navbar"><div class="navbar-inner" style="background:#FAFAFA; border-bottom:1px solid rgba(0,0,0,.09)"><div class="container"><a class="brand" style="color:#000000" href="../../../">Acerola Docs</a><a href="#" id="theme-toggle" class="brand" style="color:#000000" onclick="toggleTheme()" title="Toggle Dark Mode"><i class="fa fa-moon-o"></i></a></div></div></div></nav><div class="container main-content"><div class="row-fluid"><div class="span3"><div class="well sidebar-nav"><form class="form-search" id="searchForm"><div class="input-prepend input-block-level"><span class="add-on"><i class="fa fa-search"></i></span><input id="search" type="text" placeholder="Filter (Ctrl+P)" autocomplete="off"/></div></form></div><div class="well sidebar-nav" id="explorer"><div id="nav"></div></div></div><div class="span9"><div class="page-header"><h1><small>class</small> Agent</h1><h4><small>package <a href="../../../js/node/http/index.html">js.node.http</a></small></h4>    <h4><small><span class="muted">extended by </span><a class="type" title="js.node.https.Agent - An Agent object for HTTPS similar to http." href="../../../js/node/https/Agent.html">Agent</a></small></h4><span class="label label-meta label-meta-jsRequire" title="Generate JavaScript module require expression for given extern.">@:jsRequire(&quot;http&quot;,&quot;Agent&quot;)</span></div><div class="body"><div class="doc doc-main"><p>An <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code> is responsible for managing connection persistence and reuse for HTTP clients.
It maintains a queue of pending requests for a given host and port, reusing a single socket connection for each until the queue is empty,
at which time the socket is either destroyed or put into a pool where it is kept to be used again for requests to the same host and port.
Whether it is destroyed or pooled depends on the <code>keepAlive</code> option.</p>
<p>Pooled connections have TCP Keep-Alive enabled for them, but servers may still close idle connections, in which case they will be removed
from the pool and a new connection will be made when a new HTTP request is made for that host and port.
Servers may also refuse to allow multiple requests over the same connection, in which case the connection will have to be remade for every
request and cannot be pooled.
The <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code> will still make the requests to that server, but each one will occur over a new connection.</p>
<p>When a connection is closed by the client or the server, it is removed from the pool.
Any unused sockets in the pool will be unrefed so as not to keep the Node.js process running when there are no outstanding requests.
(see <a href="https://nodejs.org/api/net.html#net_socket_unref">socket.unref()</a>).</p>
<p>It is good practice, to <code>destroy()</code> an Agent instance when it is no longer in use, because unused sockets consume OS resources.</p>
<p>Sockets are removed from an agent when the socket emits either a <code>'close'</code> event or an <code>'agentRemove'</code> event.
When intending to keep one HTTP request open for a long time without keeping it in the agent, something like the following may be done.</p>
<p>An agent may also be used for an individual request. By providing <code>{agent: <a href="../../../Bool.html">false</a>}</code> as an option to the <code>http.get()</code> or <code>http.request()</code> functions,
a one-time use <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code> with default options will be used for the client connection.</p></div><h3 class="section">Constructor</h3><div class="fields"><div class="field "><a name="new"></a><h3 class="anchor"><code><a href="#new"><span class="identifier">new</span></a>(<span style="white-space:nowrap">?options:<a class="type" title="Null - Null&amp;lt;T&amp;gt; is a wrapper that can be used to make the basic types Int, Float and Bool nullable on static targets." href="../../../Null.html">Null</a>&lt;<a class="type" title="js.node.http.HttpAgentOptions - Options for Agent constructor." href="../../../js/node/http/HttpAgentOptions.html">HttpAgentOptions</a>&gt;</span>)</code></h3><div class="doc"><p><code>options</code> in socket.connect() are also supported.</p>
<p>The default <code>http.globalAgent</code> that is used by <code>http.request()</code> has all of these values set to their respective defaults.</p>
<p>To configure any of them, a custom <code><a href="../../../js/node/http/Agent.html#Agent">http.Agent</a></code> instance must be created.</p></div></div></div><h3 class="section">Variables</h3><div class="fields"><div class="field "><a name="freeSockets"></a><h3 class="anchor"><code><span class="label">read only</span><a href="#freeSockets"><span class="identifier">freeSockets</span></a>:<a class="type" title="haxe.DynamicAccess - DynamicAccess is an abstract type for working with anonymous structures that are intended to hold collections of objects by the string key." href="../../../haxe/DynamicAccess.html">DynamicAccess</a>&lt;<a class="type" title="Array - An Array is a storage for values." href="../../../Array.html">Array</a>&lt;<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a>&gt;&gt;</code></h3><div class="doc"><p>An object which contains arrays of sockets currently awaiting use by the agent when keepAlive is enabled.
Do not modify.</p></div></div><div class="field "><a name="maxFreeSockets"></a><h3 class="anchor"><code><a href="#maxFreeSockets"><span class="identifier">maxFreeSockets</span></a>:<a class="type" title="Float - The standard Float type, this is a double-precision IEEE 64bit float." href="../../../Float.html">Float</a></code></h3><div class="doc"><p>By default set to <code>256</code>.
For agents with <code>keepAlive</code> enabled, this sets the maximum number of sockets that will be left open in the free state.</p></div></div><div class="field "><a name="maxSockets"></a><h3 class="anchor"><code><a href="#maxSockets"><span class="identifier">maxSockets</span></a>:<a class="type" title="Float - The standard Float type, this is a double-precision IEEE 64bit float." href="../../../Float.html">Float</a></code></h3><div class="doc"><p>By default set to <code>Infinity</code>.
Determines how many concurrent sockets the agent can have open per origin. Origin is the returned value of <code>getName()</code>.</p></div></div><div class="field "><a name="requests"></a><h3 class="anchor"><code><span class="label">read only</span><a href="#requests"><span class="identifier">requests</span></a>:<a class="type" title="haxe.DynamicAccess - DynamicAccess is an abstract type for working with anonymous structures that are intended to hold collections of objects by the string key." href="../../../haxe/DynamicAccess.html">DynamicAccess</a>&lt;<a class="type" title="Array - An Array is a storage for values." href="../../../Array.html">Array</a>&lt;<a class="type" title="js.node.http.ClientRequest - This object is created internally and returned from http." href="../../../js/node/http/ClientRequest.html">ClientRequest</a>&gt;&gt;</code></h3><div class="doc"><p>An object which contains queues of requests that have not yet been assigned to sockets.
Do not modify.</p></div></div><div class="field "><a name="sockets"></a><h3 class="anchor"><code><span class="label">read only</span><a href="#sockets"><span class="identifier">sockets</span></a>:<a class="type" title="haxe.DynamicAccess - DynamicAccess is an abstract type for working with anonymous structures that are intended to hold collections of objects by the string key." href="../../../haxe/DynamicAccess.html">DynamicAccess</a>&lt;<a class="type" title="Array - An Array is a storage for values." href="../../../Array.html">Array</a>&lt;<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a>&gt;&gt;</code></h3><div class="doc"><p>An object which contains arrays of sockets currently in use by the agent.
Do not modify.</p></div></div></div><h3 class="section">Methods</h3><div class="fields"><div class="field "><a name="createConnection"></a><h3 class="anchor"><code><a href="#createConnection"><span class="identifier">createConnection</span></a>(<span style="white-space:nowrap">options:<a class="type" title="js.node.net.SocketConnectOptionsTcp - Options for the Socket." href="../../../js/node/net/SocketConnectOptionsTcp.html">SocketConnectOptionsTcp</a>,</span> <span style="white-space:nowrap">?callback:(err:<a class="type" title="js.lib.Error" href="../../../js/lib/Error.html">Error</a>, stream:<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a>)&nbsp;&#8209;&gt;&nbsp;<a class="type" title="Void - The standard Void type." href="../../../Void.html">Void</a></span>):<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a></code></h3><div class="doc"><p>Produces a socket/stream to be used for HTTP requests.</p>
<p>By default, this function is the same as <code>net.createConnection()</code>.
However, custom agents may override this method in case greater flexibility is desired.</p>
<p>A socket/stream can be supplied in one of two ways: by returning the socket/stream from this function,
or by passing the socket/stream to <code>callback</code>.</p>
<p><code>callback</code> has a signature of <code>(err, stream)</code>.</p></div></div><div class="field "><a name="destroy"></a><h3 class="anchor"><code><a href="#destroy"><span class="identifier">destroy</span></a>():<a class="type" title="Void - The standard Void type." href="../../../Void.html">Void</a></code></h3><div class="doc"><p>Destroy any sockets that are currently in use by the agent.</p>
<p>It is usually not necessary to do this. However, if using an agent with <code>keepAlive</code> enabled,
then it is best to explicitly shut down the agent when it will no longer be used. Otherwise,
sockets may hang open for quite a long time before the server terminates them.</p></div></div><div class="field "><a name="getName"></a><h3 class="anchor"><code><a href="#getName"><span class="identifier">getName</span></a>(<span style="white-space:nowrap">options:<a class="type" title="js.node.HttpRequestOptions - Type of the options object passed to Http." href="../../../js/node/HttpRequestOptions.html">HttpRequestOptions</a></span>):<a class="type" title="String - The basic String class." href="../../../String.html">String</a></code></h3><div class="doc"><p>Get a unique name for a set of request options, to determine whether a connection can be reused.
For an HTTP agent, this returns <code>host:port:localAddress</code> or <code>host:port:localAddress:family</code>.
For an HTTPS agent, the name includes the CA, cert, ciphers, and other HTTPS/TLS-specific options that determine socket reusability.</p></div></div><div class="field "><a name="keepSocketAlive"></a><h3 class="anchor"><code><a href="#keepSocketAlive"><span class="identifier">keepSocketAlive</span></a>(<span style="white-space:nowrap">socket:<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a></span>):<a class="type" title="Void - The standard Void type." href="../../../Void.html">Void</a></code></h3><div class="doc"><p>Called when <code>socket</code> is detached from a request and could be persisted by the <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code>.</p>
<p>This method can be overridden by a particular <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code> subclass.
If this method returns a falsy value, the socket will be destroyed instead of persisting it for use with the next request.</p></div></div><div class="field "><a name="reuseSocket"></a><h3 class="anchor"><code><a href="#reuseSocket"><span class="identifier">reuseSocket</span></a>(<span style="white-space:nowrap">socket:<a class="type" title="js.node.net.Socket" href="../../../js/node/net/Socket.html">Socket</a>,</span> <span style="white-space:nowrap">request:<a class="type" title="js.node.http.ClientRequest - This object is created internally and returned from http." href="../../../js/node/http/ClientRequest.html">ClientRequest</a></span>):<a class="type" title="Void - The standard Void type." href="../../../Void.html">Void</a></code></h3><div class="doc"><p>Called when <code>socket</code> is attached to <code>request</code> after being persisted because of the keep-alive options.</p>
<p>This method can be overridden by a particular <code><a href="../../../js/node/http/Agent.html#Agent">Agent</a></code> subclass.</p></div></div></div></div></div></div></div><footer class="section site-footer" style="background:#FAFAFA"><div class="container"><div class="copyright"><p style="color:#000000">&copy; 2025 &nbsp;</p></div></div></footer><script src="../../../highlighter.js"></script><link href="../../../highlighter.css" rel="stylesheet"/></body></html>